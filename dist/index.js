"use strict";require("whatwg-fetch");var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},globalOption={headers:new Headers,mode:"same-origin",credentials:"include",cache:"reload",redirect:"follow",referrer:"client",timeout:3e4},setOptions=function(t){globalOption=_extends({},globalOption,t)},parseJSON=function(t){try{return t.json()}catch(t){throw new Error("JSON Parse Error")}},checkStatus=function(t){if(t.status>=200&&t.status<300||304==t.status)return t;throw new Error(t.statusText)},setGetURL=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("[object Object]"!==Object.prototype.toString.call(e)||0===Object.keys(e).length)return t;var n=[];for(var o in e)n.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t+(-1===t.indexOf("?")?"?":"")+n.join("&")},getJSON=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=_extends({},globalOption,{method:"GET"},n),r=setGetURL(t,e);return _fetch(r,o).then(parseJSON).then(handleFetchPass,handleFetchError)},postJSON=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=_extends({},globalOption,{method:"POST",body:JSON.stringify(e)},n);return _fetch(t,o).then(parseJSON).then(handleFetchPass,handleFetchError)},putJSON=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=_extends({},globalOption,{method:"PUT",body:JSON.stringify(e)},n);return _fetch(t,o).then(parseJSON).then(handleFetchPass,handleFetchError)},handleFetchPass=function(t){return"function"==typeof globalOption.fetchSuccess&&globalOption.fetchSuccess(t),t},handleFetchError=function(t){throw"function"==typeof globalOption.fetchError&&globalOption.fetchError(t),new Error(t.message)},_fetch=function(t,e){return new Promise(function(n,o){var r=0,c=new Request(t,e);r=setTimeout(function(){var n=new Error(t+" timeout");n.fetchOption=e,o(n)},e.timeout),"function"==typeof e.fetchStart&&e.fetchStart(),fetch(c).then(function(t){clearTimeout(r),t.fetchOption=e,n(t)},function(t){clearTimeout(r),t.fetchOption=e,o(t)})}).then(checkStatus)},main={setOptions:setOptions,getJSON:getJSON,postJSON:postJSON,putJSON:putJSON};module.exports=main;
